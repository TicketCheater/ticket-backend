# JWT 는 Stateless 하게 검증되어야 하는가

## JWT 인가 처리 방식
- 로그인 시 Web-Service 에서 JWT 을 발급한다.
- JWT 클레임에는 사용자의 이름을 담는다.
- 인증된 사용자인지 확인하기 위한 부분은 API Gateway 의 AuthorizationHeaderFilter 를 거치게 한다.
- AuthorizationHeaderFilter 는 Payload 가 정상적으로 추출되는 지, 사용자의 이름이 담겨져 있는 지만 확인한다.
- 주목할 점은, 사용자의 이름이 DB 에 있는지 확인하지 않는다는 점이다.
- 확인이 끝나면 필터를 통과한다.

## 장점
- 단순함: API Gateway 에서 JWT 를 직접 검증하기 때문에 시스템이 더 간단하고 구현하기 쉽다.
- 성능: 사용자 인증이 API Gateway 에서 처리되므로 인증 요청이 백엔드 서버로 전달되지 않아 서버 부하가 줄어든다.
- 확장성: 인증 로직이 중앙 집중화되어 있기 때문에 확장하기 쉽다.

## 발생할 수 있는 문제점
- 인가된 사용자의 실제 존재 여부 확인 불가: 만약 비밀키가 유출되어 임의의 사용자로 JWT 를 발급한다면, 이를 막을 수 없어 애플리케이션의 보안이 저하될 수 있다.
- 데이터 무결성 문제: JWT 를 사용하여 사용자 인증을 수행할 때, 해당 사용자의 정보가 변경되었을 때 이를 감지할 방법이 없다. 이를 반영하지 않으면 무결성이 깨질 수 있다.

## 해결책
- 인가 필터 통과 후 Web-Server 에서 사용자를 DB 에서 검증
- 사용자 이름 수정 불가: JWT 클레임에는 사용자 이름만 담는다. 회원 수정 시에도 회원 이름은 수정 불가하다.

## 고민해야 할 점
- 대기열 시스템(Flow-Service) 는 DB 를 참조하지 않기 때문에 사용자를 확인할 수 없다.
- Web-Service 에서 Flow-Service 로 보안을 더해서 요청을 보내는 것은 어떨까?
- 프로젝트 진행하면서 문서 수정할 것
